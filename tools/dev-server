#!/usr/bin/env node
'use strict';

const path = require('path');
const run = require('./run');
const env = require('../app/env');
const needToMigrate = require('./migration-status');

const ROOT_DIR = path.resolve(__dirname, '../');

env.setEnv('mode', 'development');
(async function dev_server() {
  if (needToMigrate) {
    await run('./run-migrations --development');
  }

  let cmd = 'npx nodemon tools/dev-server.js';
  cmd += ' --config tools/nodemon.json';
  run(cmd, { cwd: ROOT_DIR });
})();
